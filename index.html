<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>King Dev Builderr - Engine</title>
    <style>
        :root { --primary: #3b82f6; --dark: #0f172a; --panel: #1e293b; --accent: #10b981; }
        body { display: flex; height: 100vh; margin: 0; font-family: 'Segoe UI', sans-serif; background: #000; color: white; overflow: hidden; }
        #sidebar { width: 320px; background: var(--panel); border-right: 1px solid #334155; display: flex; flex-direction: column; z-index: 10; overflow-y: auto; }
        .panel-section { padding: 15px; border-bottom: 1px solid #334155; }
        #editor-container { flex-grow: 1; background: #0a0a0a; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        #canvas { width: 375px; height: 667px; background: white; color: black; border-radius: 5px; position: relative; overflow: hidden; box-shadow: 0 0 50px rgba(59, 130, 246, 0.2); }
        .element { position: absolute; cursor: move; user-select: none; border: 2px solid transparent; box-sizing: border-box; display: flex; align-items: center; justify-content: center; text-align: center; }
        .selected { border: 2px solid var(--primary) !important; z-index: 100; }
        label { font-size: 11px; color: #94a3b8; display: block; margin-top: 8px; text-transform: uppercase; }
        input, select { width: 100%; background: #0f172a; color: white; border: 1px solid #475569; padding: 5px; border-radius: 4px; }
        .comp-btn { padding: 10px; background: var(--primary); border: none; color: white; cursor: pointer; border-radius: 5px; width: 100%; margin-bottom: 5px; font-weight: bold; }
    </style>
</head>
<body>

<div id="sidebar">
    <div class="panel-section">
        <h3>Páginas</h3>
        <select id="page-selector" onchange="switchPage(this.value)"></select>
        <button onclick="addNewPage()" style="width:100%; margin-top:5px">+ Nova Página</button>
    </div>
    <div class="panel-section">
        <h3>Componentes</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <button class="comp-btn" onclick="addElement('button')">Botão</button>
            <button class="comp-btn" onclick="addElement('div')">Caixa</button>
            <button class="comp-btn" onclick="addElement('h2')">Título</button>
            <button class="comp-btn" onclick="addElement('img')">Imagem</button>
        </div>
    </div>
    <div id="inspector" class="panel-section" style="display:none;">
        <h3 style="color: var(--accent)">Propriedades</h3>
        <label>Texto / URL Imagem:</label>
        <input type="text" id="prop-text" oninput="updateElement()">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div><label>Largura:</label><input type="number" id="prop-w" oninput="updateElement()"></div>
            <div><label>Altura:</label><input type="number" id="prop-h" oninput="updateElement()"></div>
        </div>
        <label>Cor de Fundo:</label>
        <input type="color" id="prop-bg" oninput="updateElement()">
        <label>Cor do Texto:</label>
        <input type="color" id="prop-color" oninput="updateElement()">
        <label>Arredondar Borda:</label>
        <input type="range" id="prop-radius" min="0" max="50" oninput="updateElement()">
        <label style="color: #fbbf24">Ação ao Clicar:</label>
        <select id="prop-link" onchange="updateElement()"></select>
        <button onclick="deleteElement()" style="background:#ef4444; margin-top:20px; border:none; color:white; padding:10px; width:100%; cursor:pointer; border-radius: 5px;">Remover Objeto</button>
    </div>
    <button onclick="exportCode()" style="background: var(--accent); color:white; padding:20px; border:none; cursor:pointer; font-weight:bold;">EXPORTAR SITE</button>
</div>

<div id="editor-container">
    <div id="canvas"></div>
</div>

<script>
    let project = {
        pages: { page1: { title: "Home", elements: [] } },
        currentPage: 'page1',
        selectedId: null
    };

    function addNewPage() {
        const id = 'page' + (Object.keys(project.pages).length + 1);
        const name = prompt("Nome da página:");
        if(!name) return;
        project.pages[id] = { title: name, elements: [] };
        updateSelectors();
        switchPage(id);
    }

    function updateSelectors() {
        const sel = document.getElementById('page-selector');
        const linkSel = document.getElementById('prop-link');
        sel.innerHTML = '';
        linkSel.innerHTML = '<option value="">Nenhuma</option>';
        for (let id in project.pages) {
            sel.innerHTML += `<option value="${id}">${project.pages[id].title}</option>`;
            linkSel.innerHTML += `<option value="${id}">Ir para ${project.pages[id].title}</option>`;
        }
    }

    function switchPage(id) {
        project.currentPage = id;
        project.selectedId = null;
        document.getElementById('inspector').style.display = 'none';
        updateSelectors();
        document.getElementById('page-selector').value = id;
        render();
    }

    function addElement(type) {
        const el = {
            id: 'el-' + Date.now(),
            type: type,
            text: type === 'img' ? 'https://via.placeholder.com/150' : 'Novo Texto',
            x: 50, y: 50, w: 150, h: 50,
            styles: { background: type === 'button' ? '#3b82f6' : '#cccccc', color: '#000000', radius: 5 },
            link: ''
        };
        project.pages[project.currentPage].elements.push(el);
        render();
        selectElement(el.id);
    }

    function render() {
        const canvas = document.getElementById('canvas');
        canvas.innerHTML = '';
        project.pages[project.currentPage].elements.forEach(el => {
            const div = document.createElement(el.type === 'button' ? 'button' : 'div');
            div.className = `element ${project.selectedId === el.id ? 'selected' : ''}`;
            div.style.cssText = `left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; background:${el.styles.background}; color:${el.styles.color}; border-radius:${el.styles.radius}px; position:absolute; border:none;`;
            if(el.type === 'img') div.innerHTML = `<img src="${el.text}" style="width:100%;height:100%;pointer-events:none;object-fit:cover;">`;
            else div.innerText = el.text;
            div.onmousedown = (e) => {
                project.selectedId = el.id;
                selectElement(el.id);
                let rect = canvas.getBoundingClientRect();
                let shiftX = e.clientX - rect.left - el.x;
                let shiftY = e.clientY - rect.top - el.y;
                document.onmousemove = (e) => {
                    el.x = e.clientX - rect.left - shiftX;
                    el.y = e.clientY - rect.top - shiftY;
                    render();
                };
                document.onmouseup = () => document.onmousemove = null;
            };
            canvas.appendChild(div);
        });
    }

    function selectElement(id) {
        project.selectedId = id;
        const el = project.pages[project.currentPage].elements.find(e => e.id === id);
        document.getElementById('inspector').style.display = 'block';
        document.getElementById('prop-text').value = el.text;
        document.getElementById('prop-w').value = el.w;
        document.getElementById('prop-h').value = el.h;
        document.getElementById('prop-bg').value = el.styles.background;
        document.getElementById('prop-color').value = el.styles.color;
        document.getElementById('prop-radius').value = el.styles.radius;
        document.getElementById('prop-link').value = el.link;
        render();
    }

    function updateElement() {
        const el = project.pages[project.currentPage].elements.find(e => e.id === project.selectedId);
        el.text = document.getElementById('prop-text').value;
        el.w = parseInt(document.getElementById('prop-w').value);
        el.h = parseInt(document.getElementById('prop-h').value);
        el.styles.background = document.getElementById('prop-bg').value;
        el.styles.color = document.getElementById('prop-color').value;
        el.styles.radius = document.getElementById('prop-radius').value;
        el.link = document.getElementById('prop-link').value;
        render();
    }

    function deleteElement() {
        project.pages[project.currentPage].elements = project.pages[project.currentPage].elements.filter(e => e.id !== project.selectedId);
        project.selectedId = null;
        document.getElementById('inspector').style.display = 'none';
        render();
    }

    function exportCode() {
        let pagesHtml = '';
        for (let id in project.pages) {
            let elementsHtml = '';
            project.pages[id].elements.forEach(el => {
                const action = el.link ? `onclick="goTo('${el.link}')"` : '';
                const style = `position:absolute; left:${el.x}px; top:${el.y}px; width:${el.w}px; height:${el.h}px; background:${el.styles.background}; color:${el.styles.color}; border-radius:${el.styles.radius}px; border:none; cursor:pointer; overflow:hidden; display:flex; align-items:center; justify-content:center;`;
                if(el.type === 'img') elementsHtml += `<img src="${el.text}" style="${style}" ${action}>`;
                else elementsHtml += `<${el.type === 'button' ? 'button' : 'div'} style="${style}" ${action}>${el.text}</${el.type === 'button' ? 'button' : 'div'}>`;
            });
            pagesHtml += `<div id="${id}" class="page" style="display:${id === 'page1' ? 'block' : 'none'}; width:100%; height:100vh; position:relative;">${elementsHtml}</div>`;
        }
        const blob = new Blob([`<html><body style="margin:0; overflow:hidden;">${pagesHtml}<script>function goTo(id){document.querySelectorAll('.page').forEach(p=>p.style.display='none');document.getElementById(id).style.display='block';}<\/script></body></html>`], {type:'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'king_dev_site.html';
        a.click();
    }
    updateSelectors();
</script>
</body>
</html>
